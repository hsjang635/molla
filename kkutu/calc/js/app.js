const inputExp = document.getElementById("input-exp");
const inputPing = document.getElementById("input-ping");
const inputNJ = document.getElementById("input-NJ"); // NJ: 낱장.

inputExp.addEventListener("input", f_calculate);
inputPing.addEventListener("input", f_calculate);
inputNJ.addEventListener("input", f_calculate);

function f_calculate() {
    let inputs = f_setInput();
    f_printStatus(inputs);
    f_printResult(f_setOutput(inputs), inputs);
}

function f_printStatus(a_inputs) {
    const prtExp = document.getElementById("exp");
    const prtPing = document.getElementById("ping");
    const prtNJ = document.getElementById("NJ");

    prtExp.innerText = f_checkStatus(a_inputs.exp);
    prtPing.innerText = f_checkStatus(a_inputs.ping);
    prtNJ.innerText = f_checkStatus(a_inputs.NJ);

    function f_checkStatus(a_value) {
        if (isNaN(a_value)) {
            return "Strange Num!";
        } else {
            return a_value;
        }
    }
}

function f_checkInput(a_value) {
    if(a_value === '') {
        return 0;
    } else if (parseInt(a_value) > 9999999999 || parseInt(a_value) < 0) {
        return NaN;
    } else {
        return parseInt(a_value);
    }
}

function f_setInput() { 
    const inputList = {
        exp:f_checkInput(inputExp.value),
        ping:f_checkInput(inputPing.value),
        NJ:f_checkInput(inputNJ.value),
    }

    return inputList;
}

function f_setOutput(a_inputs) {
    const outputList = {
        level:f_setLevel(a_inputs.exp),
        ping2NJ:a_inputs.NJ+Math.floor(a_inputs.ping/20),
        NJPerExp:Math.floor((Math.sqrt(8*a_inputs.exp+1)+1)/2),
    };
    outputList.NJ2Exp = (((2*outputList.NJPerExp)+outputList.ping2NJ-1)*outputList.ping2NJ)/2;
    outputList.finalExp = a_inputs.exp+outputList.NJ2Exp;
    outputList.finalLevel = f_setLevel(outputList.finalExp);


    function f_setLevel(a_exp) {
        if(isNaN(a_exp)) { return NaN; }
        const exps = [ 
            120, 240, 360, 480, 714, 894, 1074, 1254, 1434, 1746, 1986, 2226, 2466, 2706, 3470, 3890, 4310, 4730, 5150, 5774, 6254, 6854, 7454, 8054, 8912, 9692, 10472, 11252, 12032, 13779, 14739, 15699, 16659, 17739, 19221, 20361, 21621, 22881, 24141, 26013, 27453, 28893, 30453, 32013, 37255, 39175, 41095, 43135, 45175, 48061, 50281, 52621, 54961, 57301, 60577, 63097, 65737, 68377, 71137, 76488, 79428, 82488, 85548, 88908, 93354, 96894, 100434, 104094, 107874, 112866, 116826, 120906, 124986, 129186, 137158, 141538, 146038, 150838, 155638, 162112, 167212, 172312, 177532, 182872, 190048, 195568, 201208, 206968, 212848, 229883, 236123, 242483, 248963, 255563, 264377, 271157, 278057, 285077, 292217, 301733, 309353, 317093, 324953, 332933, 347784, 355944, 364224, 372624, 381144, 392454, 401454, 410574, 419814, 429174, 441576, 451236, 461016, 470916, 480936, 500046, 510666, 521406, 532266, 543246, 557754, 569034, 580434, 592134, 603954, 619710, 631950, 644310, 656790, 669390, 705098, 718298, 731618, 745058, 758618, 776636, 790616, 804716, 819116, 833756, 853022, 867962, 883142, 898442, 913862, 942800, 958820, 974960, 991340, 1007840, 1029524, 1046624, 1063844, 1081184, 1098764, 1121852, 1139852, 1157972, 1176512, 1195172, 1229679, 1248759, 1267959, 1287399, 1307139, 1333191, 1353351, 1373751, 1394391, 1415151, 1442763, 1464123, 1485723, 1507443, 1529403, 1590664, 1613224, 1636024, 1658944, 1682104, 1712602, 1736362, 1760362, 1784602, 1808962, 1841020, 1866100, 1891300, 1916740, 1942420, 1989704, 2015804, 2042324, 2069084, 2096084, 2131418, 2158838, 2186678, 2214758, 2242958, 2280008, 2308748, 2337908, 2367308, 2396948, 2451439, 2481499, 2511979, 2542699, 2573659, 2614297, 2645977, 2677897, 2710057, 2742457, 2784967, 2818087, 2851447, 2885047, 2918887, 3012581, 3047141, 3081941, 3116981, 3152261, 3198749, 3234749, 3270989, 3307469, 3344369, 3392729, 3430169, 3467849, 3505769, 3544109, 3614652, 3670152, 3725992, 3782412, 3839172, 3913532, 3971072, 4029362, 4087992, 4146962, 4224195, 4284355, 4344855, 4405695, 4466875, 4579770, 4642140, 4704850, 4767900, 4831700, 4915212, 4979792, 5044882, 5110552, 5176562, 5263168, 5330128, 5397668, 5465718, 5534108, 5723133, 5792713, 5862633, 5933063, 6004073, 6097179, 6169139, 6241609, 6314659, 6388049, 6484249, 6558589, 6633679, 6709109, 6785049, 6924807, 7001937, 7079577, 7157557, 7236287, 7339208, 7418888, 7499148, 7579918, 7661198, 7767434, 7849904, 7932884, 8016204, 8100274, 8254392, 8339412, 8425182, 8511462, 8598082, 8711481, 8799461, 8887781, 8976611, 9066191, 9183438, 9273968, 9365248, 9457038, 9549338, 9803638, 9897128, 9991128, 10085638, 10180898, 10305529, 10401739, 10498699, 10596169, 10694149, 10822628, 10921968, 11021818, 11122418, 11223528, 11408658, 11510958, 11613768, 11717088, 11821158, 11957242, 12062432, 12168372, 12274822, 12381782, 12521935, 12630255, 12739085, 12848665, 12958755, 13160538, 13272158, 13384288, 13496928, 13610318, 13758518, 13873028, 13988288, 14104058, 14220338, 14372828, 14490638, 14608958, 14728028, 14847608, 15176846, 15297956, 15419576, 15541946, 15664826, 15825584, 15949994, 16074914, 16200344, 16326694, 16491742, 16619212, 16747602, 16876502, 17006152, 17243535, 17374475, 17506165, 17638535, 17771415, 17945264, 18079674, 18214834, 18350504, 18486854, 18665214, 18803094, 18941484, 19080794, 19220614, 19476943, 19618293, 19760153, 19902933, 20046223, 20233826, 20378646, 20524146, 20670566, 20817496, 21009831, 21158291, 21307431, 21457321, 21607891, 22021732, 22173832, 22326612, 22480142, 22634352, 22836151, 22991891, 23148311, 23305651, 23463501, 23670032, 23829582, 23989642, 24150622, 24312282, 24608360, 24771550, 24935420, 25100210, 25265680, 25481896, 25648896, 25816816, 25985416, 26154526, 26375695, 26546505, 26718235, 26890645, 27063975, 27380855, 27555475, 27731015, 27907235, 28084375, 28315671, 28494511, 28674031, 28854231, 29035351, 29271821, 29454641, 29638141, 29822561, 30007661, 30515769, 30702569, 30890049, 31078449, 31267529, 31514659, 31705439, 31897139, 32089519, 32282819, 32535123, 32729883, 32925563, 33121923, 33319203, 33679982, 33879132, 34078962, 34279712, 34481142, 34744327, 34947457, 35151677, 35356577, 35562157, 35830737, 36038187, 36246557, 36455607, 36665577, 37049451, 37323371, 37598171, 37874151, 38151231, 38513151, 38792431, 39073111, 39354671, 39637411, 40006585, 40291745, 40577785, 40865225, 41153545, 41944863, 42235603, 42527223, 42820243, 43114143, 43498215, 43794535, 44092255, 44390855, 44690635, 45081961, 45384161, 45687461, 45991941, 46297521, 46856479, 47164479, 47473879, 47784159, 48095839, 48502349, 48816449, 49131429, 49447809, 49765589, 50180029, 50500229, 50821529, 51144009, 51467589, 52059307, 52385307, 52712707, 53041207, 53370887, 53801083, 54133403, 54466603, 54801203, 55136903, 55575315, 55913435, 56252955, 56593575, 56935595, 57873514, 58217954, 58563794, 58910734, 59259074, 59713528, 60064288, 60416148, 60769408, 61123768, 61586438, 61943438, 62301838, 62661638, 63022538, 63682179, 64045499, 64410219, 64776039, 65143259, 65622257, 65992117, 66363077, 66735437, 67109197, 67596697, 67973097, 68350597, 68729497, 69109497, 69804300, 70187460, 70571720, 70957380, 71344140, 71848930, 72238330, 72629130, 73021030, 73414330, 73927908, 74324068, 74721628, 75120288, 75520348, 76617317, 77020237, 77424557, 77829977, 78236797, 78767561, 79177241, 79588321, 80000501, 80414301, 80953853, 81370293, 81788353, 82207513, 82628073, 83396149, 83819569, 84244089, 84670229, 85097769, 85655183, 86085583, 86517083, 86949983, 87384503, 87950991, 88388371, 88826851, 89266951, 89708451, 90514638, 90958998, 91404458, 91851538, 92300018, 92884940, 93336280, 93789240, 94243520, 94699200, 95293482, 95752022, 96212182, 96673442, 97136322, 98404789, 98870529, 99337889, 99806349, 100276429, 100889821, 101362761, 101837321, 102313501, 102790781, 103413533, 103893893, 104375653, 104859033, 105343733, 106229090, 106716950, 107206130, 107696930, 108189350, 108831108, 109326388, 109822988, 110321208, 110820828, 111472232, 111974932, 112479252, 112984892, 113492152, 114418568, 114928688, 115440428, 115953788, 116468468, 117139840, 117657900, 118177280, 118698280, 119220900, 119902204, 120427904, 120955224, 121483864, 122014124, 123466539, 123999879, 124534839, 125071419, 125609319, 126310877, 126852157, 127394757, 127938977, 128484817, 129196307, 129745227, 130295767, 130847627, 131401107, 132412044, 132968824, 133527224, 134087244, 134648584, 135380614, 135945334, 136511594, 137079474, 137648974, 138391222, 138964022, 139538442, 140114482, 140691842, 141746241, 142327201, 142909481, 143493381, 144079121, 144842481, 145431301, 146021961, 146614241, 147207841, 147982095, 148579295, 149177815, 149778175, 150380155
        ]; //exps[9] = demanding exp of level '10'.

        exps.push(a_exp);
        exps.sort(function(a,b) { return a<b?1:a>b?-1:0; }); //descending order.
        index = exps.indexOf(a_exp);
        exps.splice(index, 1);
        return 720 - index;
    }

    return outputList;
}

function f_printResult(a_outputs, a_inputs) {
    const prtLevel = document.getElementById("level");
    const prtPing2NJ = document.getElementById("ping-2-NJ");
    const prtNJPerExp = document.getElementById("NJ-per-exp");
    const prtNJ2Exp = document.getElementById("NJ-2-exp");
    const prtFinalExp = document.getElementById("final-exp");
    const prtFinalLevel = document.getElementById("final-level");

    prtLevel.innerText = f_checkValueIsNaN(a_outputs.level);
    prtPing2NJ.innerText = f_checkValueIsNaN(a_outputs.ping2NJ);
    prtNJPerExp.innerText = f_checkValueIsNaN(a_outputs.NJPerExp);
    prtNJ2Exp.innerText = f_checkValueIsNaN(a_outputs.NJ2Exp);
    prtFinalExp.innerText = f_checkValueIsNaN(a_outputs.finalExp);
    prtFinalLevel.innerText = f_checkValueIsNaN(a_outputs.finalLevel);

    function f_checkValueIsNaN(a_value) {
        if (isNaN(a_inputs.exp) || isNaN(a_inputs.ping) || isNaN(a_inputs.NJ)) {
            return NaN;
        } else {
            return a_value;
        }
    }
}
